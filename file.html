<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>PDF Uploader</title>
    <style>
        body { font-family: sans-serif; background:#f0f0f0; padding:20px; }
        .card { max-width:600px; margin:0 auto; background:white; padding:20px; border-radius:8px; box-shadow:0 2px 10px rgba(0,0,0,0.1); }
        .drop-zone { border:2px dashed #ccc; padding:40px; text-align:center; cursor:pointer; border-radius:4px; margin-bottom:15px; }
        .drop-zone:hover { background:#f9f9f9; border-color:#999; }
        button { background:#007bff; color:white; border:none; padding:10px 20px; border-radius:4px; cursor:pointer; font-size:16px; }
        button:hover { background:#0056b3; }
        #status { margin-top:10px; color:#555; }
        #link-container { margin-top:20px; word-break: break-all; padding: 10px; background: #eef; border-radius: 4px; display: none; }
        a { color: #007bff; text-decoration: none; font-weight: bold; }
    </style>
</head>
<body>

<div class="card">
    <h2>Upload PDF</h2>
    
    <div class="drop-zone" id="dropZone">
        Click or Drag PDF here
    </div>
    <input type="file" id="fileInput" accept="application/pdf" style="display:none">
    
    <div style="margin-bottom:15px;">
        <label>Expires in (minutes):</label>
        <input type="number" id="expiresInput" value="1440" style="width:60px; padding:5px;">
    </div>

    <button type="button" id="uploadBtn">Upload</button>
    
    <div id="status"></div>
    <div id="link-container">
        Generated Link: <br>
        <a id="resultLink" href="#" target="_blank"></a>
    </div>
</div>

<script>
    const BASE_URL = 'http://localhost:3000'; 

    const dropZone = document.getElementById('dropZone');
    const fileInput = document.getElementById('fileInput');
    const uploadBtn = document.getElementById('uploadBtn');
    const statusDiv = document.getElementById('status');
    const linkContainer = document.getElementById('link-container');
    const resultLink = document.getElementById('resultLink');
    let pickedFile = null;

    dropZone.addEventListener('click', () => fileInput.click());
    
    fileInput.addEventListener('change', (e) => handleFile(e.target.files[0]));
    
    dropZone.addEventListener('dragover', (e) => { e.preventDefault(); dropZone.style.borderColor = '#007bff'; });
    dropZone.addEventListener('dragleave', () => { dropZone.style.borderColor = '#ccc'; });
    dropZone.addEventListener('drop', (e) => {
        e.preventDefault();
        dropZone.style.borderColor = '#ccc';
        handleFile(e.dataTransfer.files[0]);
    });

    function handleFile(file) {
        if (!file) return;
        if (file.type !== 'application/pdf') {
            statusDiv.innerText = "Error: Only PDF files allowed.";
            return;
        }
        pickedFile = file;
        statusDiv.innerText = `Selected: ${file.name}`;
    }

    uploadBtn.addEventListener('click', async (e) => {
        e.preventDefault(); // Stop page reload

        if (!pickedFile) {
            statusDiv.innerText = "Please select a file first.";
            return;
        }

        statusDiv.innerText = "Uploading...";
        linkContainer.style.display = 'none';

        const formData = new FormData();
        formData.append('file', pickedFile);
        formData.append('expiresMinutes', document.getElementById('expiresInput').value);

        try {
            const response = await fetch(`${BASE_URL}/upload`, {
                method: 'POST',
                body: formData
            });

            if (!response.ok) throw new Error("Upload failed");

            const data = await response.json();
            
            statusDiv.innerText = "Upload Successful!";
            resultLink.href = data.viewer;
            resultLink.innerText = data.viewer;
            linkContainer.style.display = 'block';

        } catch (error) {
            console.error(error);
            statusDiv.innerText = "Error uploading file. Check console.";
        }
    });
</script>

</body>
</html>